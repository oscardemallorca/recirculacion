<!DOCTYPE html>
<!-- saved from url=(0040)http://oyedisseny.com/recirculacion.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<title>Recirculación</title>
	<style>
		body{
			background-color: #fec202;
		}
		#recirculacion{
			display: block;
			height: 30px;
			background-color: #ccc;
		}
	</style>
    <!--Import Google Icon Font-->
    <link href="./index_files/icon" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="materialize.min.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Compiled and minified JavaScript -->
	<script src="materialize.min.js"></script>
	<!-- Otros -->
	<meta name="author" content="Óscar Malagón">
	<meta name="description" content="Cálculo de recirculación de una piscina">
	<meta name="keywords" content="HTML, CSS, JavaScript, JS, piscina, recirculación">
	<meta http-equiv="Cache-Control" content="no-store">
</head>

<body onload="init();">
    <section class="card">
		<p class="center">--------------
		    <br>Esta página web está desarrollada en HTML con CSS y JS por Óscar Malagón. La fórmula utilizada para el cálculo es:
		    <br><b>Tiempo de recirculación = (volumen[m3]x(2daHORA-1raHORA))/(contador2daHORA-contador1raHORA)</b>
		    <br>--------------</p>
	</section>
	<div class="container">
		<div class="row">
			<h3 class="col s12 white-text">Cálculo de recirculación</h3>
			<div class="col s12">
				<div class="card">
					<div class="card-content row">
						<span class="card-title col s12">Volumen de la piscina</span>
						<div class="input-field col s12">
							<i class="material-icons prefix">timeline</i>
							<input type="number" id="m3">
							<label for="m3">Metros cúbicos</label>
							<p><b>Nota:</b> Si no conoces el volumen agua habla con tu encargado.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="col s12 m6">
				<div class="card">
					<div class="card-content row">
						<span class="card-title col s12">Lectura anterior</span>
						<div class="input-field col s4">
							<i class="material-icons prefix">today</i>
							<input type="number" min="1" max="31" id="dia_anterior">
							<label for="dia_anterior">Día</label>
						</div>
						<div class="input-field col s3">
							<input type="number" min="1" max="12" id="mes_anterior">
							<label for="mes_anterior">Mes</label>
						</div>
						<div class="input-field col s5">
							<input type="number" min="2000" max="2030" id="ano_anterior">
							<label for="ano_anterior">Año</label>
						</div>
						<div class="input-field col s4">
							<i class="material-icons prefix">alarm</i>
							<input type="number" min="0" max="23" id="hora_anterior">
							<label for="hora_anterior">Horas</label>
						</div>
						<div class="input-field col s3">
							<input type="number" min="0" max="59" id="minuto_anterior">
							<label for="hora_anterior">Minutos</label>
						</div>
						<div class="input-field col s12">
							<i class="material-icons prefix">timeline</i>
							<input type="number" id="contador_anterior">
							<label for="contador_anterior">Contador</label>
						</div>
					</div>
				</div>
			</div>
			<div class="col s12 m6">
				<div class="card">
					<div class="card-content row">
						<span class="card-title col s12">Lectura actual</span>
						<div class="input-field col s4">
							<i class="material-icons prefix">today</i>
							<input type="number" min="1" max="31" id="dia_actual">
							<label for="dia_actual">Día</label>
						</div>
						<div class="input-field col s3">
							<input type="number" min="1" max="12" id="mes_actual">
							<label for="mes_actual">Mes</label>
						</div>
						<div class="input-field col s5">
							<input type="number" min="2000" max="2030" id="ano_actual">
							<label for="ano_actual">Año</label>
						</div>
						<div class="input-field col s4">
							<i class="material-icons prefix">alarm</i>
							<input type="number" min="0" max="23" id="hora_actual">
							<label for="hora_actual">Horas</label>
						</div>
						<div class="input-field col s3">
							<input type="number" min="0" max="59" id="minuto_actual">
							<label for="hora_actual">Minutos</label>
						</div>
						<div class="input-field col s12">
							<i class="material-icons prefix">timeline</i>
							<input type="number" id="contador_actual">
							<label for="contador_actual">Contador</label>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Botón para calcular -->
		<div class="row">
			<div class="col s12 right">
				<input class="btn right" type="button" id="calcular" value="calcular">
			</div>
		</div>
		<div class="row">
			<div class="col s12 right">
				<input class="btn grey right scale-transition" type="button" id="resultado" value="Resultado">
			</div>
		</div>
		<div class="row">
			<div class="col s12">
				<div class="card hide" id="tarjeta">
					<div class="card-content" id="mensaje_error"></div>
				</div>
			</div>
		</div>
	</div>
	
	<script>
		function init() {
			//Variables
			var hora_anterior;
			var minuto_anterior;
			var dia_anterior;
			var mes_anterior;
			var ano_anterior;
			var contador_anterior;
			var fecha_anterior;
			var hora_actual;
			var minuto_actual;
			var dia_actual;
			var mes_actual;
			var ano_actual;
			var contador_actual;
			var fecha_actual;
			var calcular = document.getElementById("calcular");
			var resultado = document.getElementById("resultado");
			var mensaje_error = document.getElementById("mensaje_error");
			var tarjeta = document.getElementById("tarjeta");
			var hora_total;
			var minuto_total;
			

			//Eventos
			calcular.onclick = function calcular () {
				var resultado = document.getElementById("resultado");
				// Preparo la fecha según estrucctura YYYYMMDD'HHMM
				var hora_actual 		= document.getElementById("hora_actual").value/24;
				var minuto_actual		= document.getElementById("minuto_actual").value/60/24;
				var dia_actual 			= document.getElementById("dia_actual").value;
				var mes_actual 			= document.getElementById("mes_actual").value*100;
				var ano_actual 			= document.getElementById("ano_actual").value*10000;
				//Sumo para obtener un total
				fecha_actual = parseFloat(hora_actual) + parseFloat(minuto_actual) + parseFloat(dia_actual) + parseFloat(mes_actual) + parseFloat(ano_actual);

				// Preparo la fecha según estrucctura YYYYMMDD'HHMM
				var hora_anterior 		= document.getElementById("hora_anterior").value/24;
				var minuto_anterior 	= document.getElementById("minuto_anterior").value/60/24;
				var dia_anterior 		= document.getElementById("dia_anterior").value;
				var mes_anterior 		= document.getElementById("mes_anterior").value*100;
				var ano_anterior 		= document.getElementById("ano_anterior").value*10000;
				//Sumo para obtener un total
				fecha_anterior = parseFloat(hora_anterior) + parseFloat(minuto_anterior) + parseFloat(dia_anterior) + parseFloat(mes_anterior) + parseFloat(ano_anterior);

				var contador_anterior 	= document.getElementById("contador_anterior").value;
				var contador_actual 	= document.getElementById("contador_actual").value;
				var m3 					= document.getElementById("m3").value;
				var calculo;

				//Hago las operacioines
				calculo = (m3*(fecha_actual-fecha_anterior))/(contador_actual-contador_anterior);
				hora_total = parseFloat(calculo)*24;
				minuto_total = (parseFloat(hora_total)-parseInt(hora_total))*60;
				console.log(calculo)
				if (hora_total - hora_total != 0) {
					resultado.value = 'Rellena todos los campos';
					resultado = resultado.setAttribute('class','btn btn-large red right scale-transition');
					mensajeError();
				} else {
					resultado.value = 'Tiempo de recirculación: ' + parseInt(hora_total) + "h. y " + parseInt(minuto_total) + "m." ;
					resultado = resultado.setAttribute('class','btn grey right scale-transition');
				}
			}
			function mensajeError(){
				tarjeta = tarjeta.setAttribute('class','card');
				// Crear nodo de tipo Element
				var parrafo = document.createElement("p");
				
				// Crear nodo de tipo Text
				var contenido = document.createTextNode('Por favor, revisa los datos introducidos. Por ejemplo, el año ha de ser completo tipo "2018", las horas en formato 24h. y el volumen en metros cúbicos.');
				
				// Añadir el nodo Text como hijo del nodo Element
				parrafo.appendChild(contenido);
				
				// Añadir el nodo Element como hijo de la pagina
				mensaje_error.appendChild(parrafo);
			}
		}
</script>

</body></html>
